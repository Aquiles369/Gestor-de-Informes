<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#000000">
<title>Repositorio de Informes (XSS / IDOR / RCE …)</title>
<link rel="icon" href="fav_Aquiles.png" type="image/x-icon">
<style>
  :root{
    --bg:#000000; --card:#141c5b; --ink:#e7ffeb; --muted:#9aa3ff;
    --accent:#7c5cff; --accent-2:#e00000; --ok:#00e0c2; --warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
    background: var(--bg);
    color:var(--ink);
    display:grid; grid-template-columns:minmax(0,1fr); place-items:center; padding:24px;
  }
  .app{width:min(1200px, 100%); display:grid; grid-template-columns: 1fr 300px; gap:18px}
  @media (max-width:980px){ .app{grid-template-columns:1fr} .float{position:static} }

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.25); padding:20px;
    backdrop-filter: blur(6px);
  }
  h1{margin:0 0 8px; font-weight:800; letter-spacing:.3px}
  .sub{color:var(--muted); margin:0 0 18px; font-size:14px}

  .category{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.015)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; margin-bottom:14px}
  .chead{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center}
  .ctitle{
    font-weight:900; letter-spacing:.4px; margin:0; font-size:18px;
    padding:6px 10px; border-radius:10px; border:1px dashed rgba(255,255,255,.18);
    background:linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,.06));
  }
  .ctitle[contenteditable="true"]{outline:2px solid rgba(124,92,255,.5)}
  .cactions{display:flex; gap:8px; flex-wrap:wrap; justify-self:end}
  .btn{
    appearance:none; border:none; border-radius:12px; padding:8px 12px; font-weight:700; letter-spacing:.2px;
    color:#0b0d1f; background:linear-gradient(90deg, var(--accent), var(--accent-2)); cursor:pointer;
    box-shadow:0 6px 18px rgba(124,92,255,.35); transition: transform .08s ease, filter .15s ease; font-size:13px;
  }
  .btn:hover{filter:brightness(1.06)}
  .btn:active{transform: translateY(1px)}
  .ghost{background:transparent; color:var(--ink); border:1px solid rgba(255,255,255,.18)}

  /* inputs & selects */
  .cfilters{display:flex; gap:8px; align-items:center; justify-self:stretch}
  .cfilter-input{
    width:100%; padding:8px 10px; border-radius:10px;
    background:rgba(255,255,255,.06); color:var(--ink);
    border:1px solid rgba(255,255,255,.14); font-weight:700; letter-spacing:.2px;
  }
  .cfilter-select{
    padding:8px 36px 8px 10px; border-radius:10px; min-width:170px;
    background:#0b0d1f; color:var(--ink);
    border:1px solid rgba(255,255,255,.18); font-weight:800; letter-spacing:.2px;
    appearance:none; -webkit-appearance:none; -moz-appearance:none;
    background-image:
      linear-gradient(45deg, rgba(255,255,255,.35) 50%, rgba(255,255,255,0) 50%),
      linear-gradient(135deg, rgba(255,255,255,.35) 50%, rgba(255,255,255,0) 50%);
    background-position: right 12px top 55%, right 6px top 55%;
    background-size: 8px 8px, 8px 8px; background-repeat:no-repeat;
  }
  .cfilter-select option{ background:#141826; color:#e6ecff; font-weight:700; }
  .cfilter-select option:checked{ background:#2b2f6b; color:#fff; }

  .items{display:grid; gap:8px; margin-top:10px}
  .item{
    display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center;
    padding:8px; border-radius:12px; border:1px dashed rgba(255,255,255,.15); background:rgba(255,255,255,.04);
    position:relative;
  }
  .item.note::before{
    content:""; position:absolute; right:8px; top:8px; width:6px; height:6px; border-radius:999px;
    background: var(--accent-2); box-shadow:0 0 6px rgba(255,0,0,.7)
  }
  .row-left{display:flex; align-items:center; gap:8px}
  .ititle{
    font-weight:800; letter-spacing:.2px; padding:6px 8px; border-radius:8px; background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.12); min-height:34px; display:flex; align-items:center; cursor:text;
  }
  .linkbox{display:flex; gap:6px; align-items:center}
  .ipayload{
    min-width:260px; max-width:420px; width:100%; padding:8px 10px; border-radius:8px;
    border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); color:var(--ink);
    font-size:13px;
  }
  .open{background:linear-gradient(90deg, var(--ok), var(--warn)); color:#0b0d1f}
  .itag{font-size:11px; color:var(--muted)}

  /* === Estados === */
  .pill{height:32px;padding:0 12px;border-radius:999px;border:0;font-weight:700;font-size:12px;
    display:inline-flex;align-items:center;cursor:pointer;box-shadow:0 0 0 1px rgba(255,255,255,.08) inset;
    background:rgba(255,255,255,.06);color:#cdd3ff;}
  .pill-none{background:rgba(255,255,255,.06);color:#bfc8d6;}
  .pill-monton{background:#9ca3af;color:#0b0e12;}
  .pill-regular{background:#3b82f6;color:#fff;}
  .pill-buen{background:#22c55e;color:#06240f;}
  .pill-muybueno{background:#f59e0b;color:#1b1200;}
  .pill-excelente{background:#ef4444;color:#fff;}
  .pill-urgente{background:#7c3aed;color:#fff;}
  .pill-luego{background:#ec4899;color:#fff;}

  .row-left > .pill{ flex:1 1 auto; justify-content:center; min-width:120px; }

  /* Tooltip */
  #tooltip{position:fixed;z-index:10000;display:none;opacity:0;max-width:520px;max-height:260px;
    overflow:auto;padding:10px 12px;border-radius:12px;background:linear-gradient(180deg,rgba(30,32,50,.98),rgba(22,24,40,.98));
    border:1px solid rgba(255,255,255,.12);color:var(--ink);box-shadow:0 12px 28px rgba(0,0,0,.45);
    transition:opacity .08s ease;}
  #tooltip.show{display:block;opacity:1;}
</style>
</head>
<body>
<main class="app">
<section class="card">
<h1>Repositorio de Informes</h1>
<p class="sub">Organizá tus <b>informes/URLs</b> por categoría. Persisten en localStorage. Incluye buscador, filtros y notas con tooltip.</p>
<div id="cats"></div>
</section>

<!-- Panel flotante -->
<aside class="float">
<h3 class="fhead">Buscar informes</h3>
<div class="search">
  <input id="q" type="text" placeholder="Ej: /report, ticket, panel, wiki…" />
  <button id="clearQ" class="btn ghost">Limpiar</button>
</div>
<div id="results" class="res"><div class="empty">Empieza a tipear para filtrar…</div></div>
<div class="itag">Sugerencia: Enter salta al primer resultado.</div>

<div class="toolbox">
  <button id="addCat" class="btn">+ Agregar categoría</button>
  <button id="export" class="btn ghost" title="Exportar base JSON">Exportar JSON</button>
  <button id="import" class="btn ghost" title="Importar JSON">Importar JSON</button>
  <button id="wipe" class="btn ghost" title="Borrar todo">Borrar todo</button>
</div>
</aside>
</main>


  <!-- Modal de notas -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mod-title">
  <div class="box">
    <center><h2 id="mod-title"> Nota</h2></center>
    <center><p id="mod-msg">Detalles, variantes, bypasses, referencias…</p></center>
    <div class="note-wrap">
      <label id="noteLabel" for="noteArea">Nota</label>
      <textarea id="noteArea" placeholder="Tips, cadenas, CSP, contextos, mutaciones…"></textarea>
      <p id="metaInfo" style="font-size:12px;color:var(--muted);margin:6px 0 0"></p>
    </div>
    <div class="actions">
      <button id="saveNote" class="btn">Guardar (Ctrl+S)</button>
      <button id="clearNote" class="btn ghost">Borrar nota</button>
      <button id="close" class="btn ghost">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal de carga masiva -->
<div id="bulkModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="bulk-title">
  <div class="box">
    <center><h2 id="bulk-title">Carga masiva de informes</h2></center>
    <center><p class="sub" style="margin:0 0 10px">Pegá <b>uno por línea</b>. Se crearán renglones automáticos.</p></center>
    <div class="note-wrap">
      <label for="bulkArea">Lista de URLs / informes</label>
      <textarea id="bulkArea" placeholder="Ejemplo:
https://example.com/report/123
https://panel.empresa.com/tickets/ABC-42
intranet.local/wiki/bug-112"></textarea>
      <div style="display:flex; gap:10px; align-items:center; margin-top:8px; color:var(--muted); font-size:12px">
        <label><input id="bulkTrimEmpty" type="checkbox" checked> Ignorar líneas vacías</label>
      </div>
    </div>
    <div class="actions">
      <button id="bulkCreate" class="btn">Crear renglones (Ctrl+Enter)</button>
      <button id="bulkCancel" class="btn ghost">Cancelar</button>
    </div>
  </div>
</div>

<!-- Tooltip -->
<div id="tooltip" role="tooltip" aria-hidden="true"></div>

<script>
(function(){
  const KEY = 'aquiles_payloads_data_v1';
  const UIKEY = 'aquiles_payloads_ui_filters_v1';
  const catsEl = document.getElementById('cats');

  function uid(){ return Math.random().toString(36).slice(2,9); }
  function load(){
    try{ const o = JSON.parse(localStorage.getItem(KEY)||''); if(o && Array.isArray(o.cats)) return o; }catch{}
    return { cats: [] };
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
  let state = load();

  // ====== Filtros UI ======
  let filters = loadFilters();
  function loadFilters(){ try{ return JSON.parse(localStorage.getItem(UIKEY)||'{}'); }catch{ return {}; } }
  function getFilter(catId){ return filters[catId] || { text:'', state:'all' }; }
  function setFilter(catId, patch){
    filters[catId] = { ...getFilter(catId), ...patch };
    localStorage.setItem(UIKEY, JSON.stringify(filters));
    render();
  }

  // ====== Estados ======
  const STATUS_SET = [
    { id:'monton',     text:'Informe del montón', cls:'pill-monton' },
    { id:'regular',    text:'Informe regular',    cls:'pill-regular' },
    { id:'buen',       text:'Informe bueno',      cls:'pill-buen' },
    { id:'muybueno',   text:'Informe muy bueno',  cls:'pill-muybueno' },
    { id:'excelente',  text:'Informe excelente',  cls:'pill-excelente' },
    { id:'urgente',    text:'Leer inmediatamente',cls:'pill-urgente' },
    { id:'luego',      text:'Leer más tarde',     cls:'pill-luego' }
  ];
  function statusObj(id){ return STATUS_SET.find(s=>s.id===id)||null; }

  // ====== Tooltip ======
  const $tt=document.getElementById('tooltip');
  function escapeHtml(s){return(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
  function tipHtml(item){
    const title=escapeHtml(item.title||'Informe');
    const body=(item.note||'').trim()?escapeHtml(item.note).replace(/\n/g,'\n'):'<i>Sin nota</i>';
    const meta=item.editedTs?`<div class="tt-meta">Última edición: ${new Date(item.editedTs).toLocaleString()}</div>`:'';
    return `<div class="tt-title">${title}</div><div class="tt-body">${body}</div>${meta}`;
  }
  function showTip(html,x,y){$tt.innerHTML=html;$tt.classList.add('show');positionTip(x,y);$tt.setAttribute('aria-hidden','false');}
  function moveTip(x,y){if($tt.classList.contains('show'))positionTip(x,y);}
  function hideTip(){$tt.classList.remove('show');$tt.setAttribute('aria-hidden','true');}
  function positionTip(x,y){
    const pad=10,off=16,mw=$tt.offsetWidth,mh=$tt.offsetHeight;
    let left=x+off,top=y+off;
    if(left+mw>innerWidth-pad)left=x-mw-off;if(left<pad)left=pad;
    if(top+mh>innerHeight-pad)top=y-mh-off;if(top<pad)top=pad;
    $tt.style.left=left+'px';$tt.style.top=top+'px';
  }
  function bindNoteTooltip(el,item){
    el.addEventListener('mouseenter',e=>showTip(tipHtml(item),e.clientX,e.clientY));
    el.addEventListener('mousemove',e=>moveTip(e.clientX,e.clientY));
    el.addEventListener('mouseleave',hideTip);
  }

  // ====== Render ======
  function render(){
    catsEl.innerHTML='';
    state.cats.forEach(cat=>{
      const wrap=document.createElement('section');
      wrap.className='category';wrap.dataset.id=cat.id;

      const head=document.createElement('div');head.className='chead';
      const title=document.createElement('h2');
      title.className='ctitle';
      title.textContent=cat.title+' ('+(cat.items?.length||0)+')';
      title.title='Doble click para editar';
      title.addEventListener('dblclick',()=>editCatTitle(title,cat));

      const fwrap=document.createElement('div');fwrap.className='cfilters';
      const fState=document.createElement('select');fState.className='cfilter-select';
      fState.innerHTML=`
        <option value="all">Estado: todos</option>
        <option value="none">Sin etiqueta</option>
        ${STATUS_SET.map(s=>`<option value="${s.id}">${s.text}</option>`).join('')}
      `;
      const curF=getFilter(cat.id);
      fState.value=curF.state;
      fState.addEventListener('change',()=>setFilter(cat.id,{state:fState.value}));

      const fText=document.createElement('input');fText.className='cfilter-input';fText.placeholder='Filtrar por texto…';
      fText.value=curF.text;
      fText.addEventListener('input',()=>setFilter(cat.id,{text:fText.value.trim().toLowerCase()}));
      fwrap.append(fState,fText);

      const actions=document.createElement('div');actions.className='cactions';
      const addItemBtn=btn('+ Agregar renglón',()=>addItem(cat.id));
      const bulkBtn=btn('Carga masiva',()=>openBulk(cat.id));
      const copyUrlsBtn=btn('Copiar URLs',()=>copyUrls(cat.id));
      const copyNotesBtn=btn('Copiar Notas',()=>copyNotes(cat.id));
      const delCatBtn=btn('Eliminar categoría',()=>delCat(cat.id),true);
      actions.append(addItemBtn,bulkBtn,copyUrlsBtn,copyNotesBtn,delCatBtn);

      head.append(title,fwrap,actions);
      wrap.appendChild(head);

      const list=document.createElement('div');list.className='items';
      const flt=getFilter(cat.id);
      const visible=(cat.items||[]).filter(it=>matchItem(it,flt));

      visible.forEach(item=>{
        const row=document.createElement('div');row.className='item';row.dataset.item=item.id;
        if((item.note||'').trim())row.classList.add('note');

        const left=document.createElement('div');left.className='row-left';
        const ititle=document.createElement('div');ititle.className='ititle';ititle.textContent=item.title||'Nuevo informe';
        ititle.addEventListener('click',e=>{e.stopPropagation();editItemTitle(ititle,cat.id,item.id);});
        const pill=renderStatusPill(cat.id,item.id);
        left.append(ititle,pill);

        const linkB=document.createElement('div');linkB.className='linkbox';
        const ipayload=document.createElement('input');ipayload.className='ipayload';ipayload.type='text';
        ipayload.placeholder='URL del informe (https://…)';
        ipayload.value=item.payload||'';
        ipayload.addEventListener('change',()=>{item.payload=ipayload.value;save();buildIndex();});
        const openBtn=document.createElement('button');openBtn.className='btn open';openBtn.textContent='Abrir';
        openBtn.addEventListener('click',()=>{if(item.payload.trim())openOne(item.payload);else alert('Sin URL');});
        linkB.append(ipayload,openBtn);

        const tools=document.createElement('div');tools.style.display='flex';tools.style.gap='6px';
        const noteBtn=btn('Nota',()=>openNote(cat.id,item.id),false);
        tools.append(noteBtn);

        row.append(left,linkB,tools);
        bindNoteTooltip(row,item);
        bindNoteTooltip(noteBtn,item);
        row.addEventListener('click',e=>{
          const t=e.target.tagName.toLowerCase();
          if(['input','button','a'].includes(t)||e.target.classList.contains('pill')||e.target.classList.contains('ititle'))return;
          openNote(cat.id,item.id);
        });
        list.appendChild(row);
      });
      wrap.appendChild(list);
      catsEl.appendChild(wrap);
    });
    buildIndex();
  }

  function btn(txt,fn,ghost=false){
    const b=document.createElement('button');
    b.className='btn'+(ghost?' ghost':'');b.textContent=txt;b.addEventListener('click',fn);return b;
  }

  function matchItem(item,flt){
    const textOk=!flt.text||(`${item.title} ${item.payload||''} ${item.note||''}`.toLowerCase().includes(flt.text));
    const stateOk=flt.state==='all'?true:flt.state==='none'?!item.status:item.status===flt.state;
    return textOk&&stateOk;
  }

  // === Copiar funciones ===
  function copyUrls(catId){
    const cat=state.cats.find(c=>c.id===catId);if(!cat)return;
    const flt=getFilter(cat.id);
    const urls=(cat.items||[]).filter(i=>matchItem(i,flt)).map(i=>i.payload).filter(Boolean);
    navigator.clipboard.writeText(urls.join('\n'));
    alert(`Copiadas ${urls.length} URLs de "${cat.title}".`);
  }
  function copyNotes(catId){
    const cat=state.cats.find(c=>c.id===catId);if(!cat)return;
    const flt=getFilter(cat.id);
    const notes=(cat.items||[]).filter(i=>matchItem(i,flt)).map(i=>i.note).filter(Boolean);
    navigator.clipboard.writeText(notes.join('\n\n'));
    alert(`Copiadas ${notes.length} notas de "${cat.title}".`);
  }

  // === resto: CRUD, buscador, etc. ===
  /* (mantiene tu lógica original para addItem, edit, notas, bulk, buscador, etc.) */
})();
</script>
</body>
</html>
